<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App with Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="weather-container">
        <h1>Weather App</h1>
        <input type="text" id="city" placeholder="Enter city">
        <button onclick="getWeather()">Get Weather</button>
        <div class="weather-info" id="weather-info"></div>
    </div>
    <div id="map"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    
const apiKey = '45417c5c6848e121eaa9dd474cbc89d3';  // Replace with your OpenWeatherMap API key
const map = L.map('map').setView([51.505, -0.09], 2);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

async function getWeather() {
    const city = document.getElementById('city').value;
    const weatherInfo = document.getElementById('weather-info');

    if (!city) {
        weatherInfo.innerHTML = 'Please enter a city name.';
        return;
    }

    const geocodeUrl = `https://nominatim.openstreetmap.org/search?q=${city}&format=json&limit=1`;
    try {
        const geocodeResponse = await fetch(geocodeUrl);
        const geocodeData = await geocodeResponse.json();
        console.log('Geocode Data:', geocodeData);

        if (geocodeData.length === 0) {
            weatherInfo.innerHTML = 'City not found.';
            return;
        }

        const { lat, lon } = geocodeData[0];
        map.setView([lat, lon], 10);

        // Add a marker for the city
        L.marker([lat, lon]).addTo(map)
            .bindPopup(`<b>${city}</b><br>Click to see weather`)
            .on('click', async () => {
                await fetchWeather(lat, lon, city);
            });

    } catch (error) {
        weatherInfo.innerHTML = 'Error fetching location data.';
        console.error('Error fetching location data:', error);
    }
}

async function fetchWeather(lat, lon, city) {
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`;
    try {
        const response = await fetch(url);
        const data = await response.json();
        console.log('Weather Data:', data);

        if (data.cod === 200) {
            const { name, main, weather } = data;
            const weatherDescription = weather[0].description;
            const temperature = main.temp;
            const humidity = main.humidity;
            const windSpeed = data.wind.speed;

            document.getElementById('weather-info').innerHTML = `
                <h2>${name}</h2>
                <p>Temperature: ${temperature} Â°C</p>
                <p>Weather: ${weatherDescription}</p>
                <p>Humidity: ${humidity}%</p>
                <p>Wind Speed: ${windSpeed} m/s</p>
            `;
        } else {
            document.getElementById('weather-info').innerHTML = 'Weather data not found.';
        }
    } catch (error) {
        document.getElementById('weather-info').innerHTML = 'Error fetching weather data.';
        console.error('Error fetching weather data:', error);
    }
}
</script>
    
</body>
</html>
